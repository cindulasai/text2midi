# MidiGen v2.0 - Menu System Improvements âœ¨

## Changes Made

### 1. **LLM Initialization Fix**
- Added `initialize_system()` function that calls `LLMConfig.initialize()` at startup
- Ensures Groq is automatically detected and set as default provider
- Displays available providers on startup: `[LLM Config] Available providers: ['groq', 'gemini']`

### 2. **Dynamic Prompt Generation (LLM-Powered)**
- `generate_dynamic_prompts()` function now calls LLM with enhanced system prompt
- Each call generates 5 completely different, unique prompts
- Prompts are now 3-5 sentences detailed with:
  - Specific emotions and atmospheres
  - Instrument choices and their roles
  - Genre, tempo, and musical style
  - Unique characteristics

- Response includes:
  ```json
  {
    "1": {
      "title": "Style Name",
      "prompt": "Detailed description...",
      "tracks": [
        {"name": "Track Name", "description": "What it does"},
        ...
      ],
      "duration": 120,
      "key_mood": "Emotional descriptor"
    }
  }
  ```

### 3. **Enhanced Menu Display**
**Before:**
```
[QUICK START] Choose a preset prompt or enter custom:
------
  1. Peaceful Meditation
  2. Epic Cinematic Orchestra
  ...
  0. Enter custom prompt
```

**After:**
```
[PRESET SELECTION] Choose from AI-generated music styles
================================================================

[OPTION 1] PEACEFUL MEDITATION
------
  Description: Create a peaceful, meditative, and ethereal ambient 
  soundscape with serene and tranquil vibes...

  [COMPOSITION DETAILS]
     * Tracks: 3 parts
     * Track 1: Ambient Pads - Floating, sustained harmonic background
     * Track 2: Bell Textures - Soft chiming and ethereal tones
     * Track 3: Wind & Nature - Gentle breezes and natural elements
     * Duration: ~120s
     * Mood: Tranquil, Spiritual, Calming

[OPTION 2] EPIC CINEMATIC ORCHESTRA
------
  ...
  [COMPOSITION DETAILS]
     * Tracks: 3 parts
     * Track 1: Strings Section - Sweeping violins and lush orchestral strings
     * Track 2: Brass & Percussion - Powerful horns, trumpets, and timpani
     * Track 3: Choir & Atmosphere - Emotional vocal textures and epic builds
     * Duration: ~180s
     * Mood: Epic, Triumphant, Inspirational

...

[OPTION 0] >> CREATE CUSTOM PROMPT
------
  Want something unique? Create your own detailed music description.
  Include: style, mood, instruments, tempo, special effects, etc.
```

#### Menu Features:
- âœ… Each option shows full prompt description (not just title)
- âœ… Composition details with track count and descriptions
- âœ… Duration expectation (~120-180 seconds)
- âœ… Keyboard mood/emotional descriptor
- âœ… Custom prompt option clearly at the end with instructions
- âœ… Better visual formatting with dividers

### 4. **Fallback Prompts Enhanced**
All 5 fallback prompts now include:
- Detailed multi-sentence descriptions
- Track array with name and description for each
- Duration in seconds
- Key mood/emotional descriptor

**Fallback Options:**
1. **Peaceful Meditation** (3 tracks, 120s) - Tranquil, Spiritual, Calming
2. **Epic Cinematic Orchestra** (3 tracks, 180s) - Epic, Triumphant, Inspirational
3. **Funky Electronic Groove** (3 tracks, 150s) - Energetic, Funky, Upbeat
4. **Dark Mysterious Ambient** (3 tracks, 140s) - Dark, Mysterious, Eerie
5. **Smooth Jazz Improvisation** (3 tracks, 160s) - Smooth, Cool, Sophisticated

### 5. **Windows Compatibility**
- Removed problematic emoji characters (ğŸ“, ğŸ’¡, âœ¨, â€¢)
- Replaced with ASCII-safe alternatives (* for bullets, >> for arrows, [TEXT] for emphasis)
- Added try/except around `describe_graph()` for Unicode errors

## How It Works Now

### Workflow:
1. User runs `poetry run python main.py`
2. System initializes: `[INIT] Starting MidiGen v2.0...`
3. LLMConfig checks for available providers (Groq, Gemini)
4. Menu displays 5 options (dynamically generated by LLM when available)
5. User sees:
   - Option 1-5: Pre-generated music styles with full details
   - Option 0: Custom prompt input
6. User selects option â†’ Prompt details shown â†’ Generation begins

### Smart Fallback:
- If LLM dynamic generation fails â†’ Use detailed fallback prompts
- User always gets rich, detailed options to choose from
- No more "always same prompts" issue!

## Result

Users now see:
- ğŸµ **Diverse, detailed prompts** - Each feeling different and interesting
- ğŸ“‹ **Track information** - Know what will be generated before selecting
- â±ï¸ **Duration estimates** - Understanding composition scope
- ğŸ¨ **Mood descriptors** - Clear emotional targeting
- ğŸ›ï¸ **Easy custom option** - Option 0 for full customization

## Testing

Run with:
```bash
poetry run python main.py
```

Select options 1-5 to see detailed menus with:
- Full prompt descriptions
- Track composition breakdown
- Duration and mood information

Or option 0 to create completely custom prompts.

---

**Status**: âœ… Complete and Ready for Testing

All changes maintain backward compatibility while dramatically improving user experience.
